<div id="input_area">
  <%= form_tag({:controller => "words", :action => "create"}, :id => "new_word_form") do %>
    <%= hidden_field_tag(:word_name, @title_word) %>
    <%= hidden_field_tag(:phoneme_string) %>
    <%= submit_tag "Create Word" %>
  <% end %>

  <div>
    <audio id="phoneme_audio1">
      <source src="/audio/jh.ogg">
      <source src="/audio/jh.mp3">
    </audio>
    <audio id="phoneme_audio2">
      <source src="/audio/eh.ogg">
      <source src="/audio/eh.mp3">
    </audio>
    <audio id="phoneme_audio3">
      <source src="/audio/s.ogg">
      <source src="/audio/s.mp3">
    </audio>
    <audio id="phoneme_audio4">
      <source src="/audio/t.ogg">
      <source src="/audio/t.mp3">
    </audio>
    <audio id="phoneme_audio5">
      <source src="/audio/er.ogg">
      <source src="/audio/er.mp3">
    </audio>
    <button id="phoneme_button">Play 'Jester'</button>
  </div>
</div>

<div id="wr_heading_row" class="word_table heading">
  <label class="prompt">
    <span class="prompt-text">
      Enter a phoneme:
    </span>
    <div class="phoneme_text "> 
      <input id="new_phoneme" class="main-input" type="text">
    </div>
  </label>
  <div class="phonemes reversed">
    <div class="spacer reversed"> </div>
  </div>
</div>

<script>
  $(document).delegate('*', 'keypress', function (evt) {
    if (!$("#new_phoneme").focus()) {
      $("#new_phoneme").focus().val($("#new_phoneme").val());
    }
  });
  $(document).ready(function() {
    $("#new_phoneme").focus().val($("#new_phoneme").val());
    // $(function() {
    //   $("#new_phoneme").autocomplete({
    //     source: '<%= new_word_path(:json) %>',
    //     select: function(event, ui) {
    //       $("#new_phoneme").val(ui.item.label);
    //       $("#wr_heading_row div.phonemes").append("<div class='single_phoneme reversed'>" + ui.item.label + "</div><div class='spacer reversed'></div>");
    //       $("#new_phoneme").val("");
    //       $("#new_phoneme").focus().val($("#new_phoneme").val());
    //       return false;
    //     }
    //   }).data("uiAutocomplete")._renderItem = function(ul, item) {
    //     return $("<li></li>")
    //       .data("item.autocomplete", item)
    //       .append("<a><span class='autoleft'>" + item.label + " (" + item.type + ")" + " </span></a>")
    //       .appendTo(ul);
    //     };
    // });
    $("#new_phoneme").tokenInput("<%= new_word_path(:json) %>", {
              propertyToSearch: "label",
              resultsFormatter: function(item){ return "<li>" + item.label + " (" + item.type + ")</li>" },
              tokenFormatter: function(item) { return "<li><p class='" + item.label + "'>" + item.label + "</p></li>" },
              hintText: ''
    });
    $("#new_word_form").submit(function() {
      $("#phoneme_string").val($.map($('.token-input-list p'), function(p) { return $(p).text(); }).join('-'));  
    });
    $("#phoneme_button").click(function() {
      var audio1 = $("#phoneme_audio1")[0];
      var audio2 = $("#phoneme_audio2")[0];
      var audio3 = $("#phoneme_audio3")[0];
      var audio4 = $("#phoneme_audio4")[0];
      var audio5 = $("#phoneme_audio5")[0];
      audio1.addEventListener("ended", function() { audio2.play(); }, true);
      audio2.addEventListener("ended", function() { audio3.play(); }, true);
      audio3.addEventListener("ended", function() { audio4.play(); }, true);
      audio4.addEventListener("ended", function() { audio5.play(); }, true);
      audio1.play();
    });
  });
</script>